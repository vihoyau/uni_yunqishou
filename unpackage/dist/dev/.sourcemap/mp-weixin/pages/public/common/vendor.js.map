{"version":3,"sources":["uni-app:///pages/public/chat/shopro/chat.js","uni-app:///pages/public/chat/wm/config.js"],"names":["service","BASE_URL","split","Socket","initData","callback","ping","is_ssl","gateway_port","ssl_type","url","config","session_id","uni","getStorageSync","token","identify","timeoutObj","lockReconnect","isClose","timer","limit","timout","setStorageSync","init","connect","connectSocket","error","res","errMsg","initEventHandle","msg","sendSocketMessage","data","Promise","resolve","onSocketMessage","code","type","closeSocket","removeStorage","key","success","console","log","clearTimeout","setTimeout","obj","objStr","JSON","stringify","start","onSocketOpen","onMsg","onSocketError","err","onSocketClose","reconnect","expression","baseURL","https_switch"],"mappings":"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","file":"pages/public/common/vendor.js","sourcesContent":["/**\n * shopro\n * 聊天配置,socket服务相关,心跳检测和重连\n */\n\n/**\n * socket\n * @param  {Object} config  - 初始化配置对象\n * @param {Number} wait = [10000]  - 心跳频率\n */\n\nimport {\n\tBASE_URL\n} from '@/env.js'\n\nconst service = BASE_URL.split('://')[1].split(':')[0];\n\nexport default class Socket {\n\tconstructor(initData, callback) {\n\t\tlet {\n\t\t\tping,\n\t\t\tis_ssl,\n\t\t\tgateway_port,\n\t\t\tssl_type\n\t\t} = initData;\n\n\t\tlet url = `${is_ssl?'wss':'ws'}://${service}:${gateway_port}/`\n\t\tif (is_ssl && ssl_type === 'reverse_proxy') {\n\t\t\turl = `wss://${service}/websocket/`\n\t\t}\n\t\tthis.config = {\n\t\t\turl: url,\n\t\t\tsession_id: uni.getStorageSync('chatSessionId'),\n\t\t\ttoken: uni.getStorageSync('token'),\n\t\t\tidentify: 'user'\n\t\t};\n\t\tthis.callback = callback; //onmsg回调\n\t\tthis.timeoutObj = null; //心跳检测定时器对象\n\t\tthis.lockReconnect = false; //检测次数锁\n\t\tthis.isClose = false; //链接断开\n\t\tthis.timer = null; // 检测定时器\n\t\tthis.limit = 0; //检测次数，默认最大12\n\t\tthis.timout = ping;\n\t\tuni.setStorageSync('isSocketOpen', false)\n\t\tthis.init()\n\t}\n\n\t// 初始化\n\tasync init() {\n\t\tawait this.connect();\n\t}\n\n\t// 连接\n\tasync connect() {\n\t\tif (!uni.getStorageSync('isSocketOpen')) {\n\t\t\tlet [error, res] = await uni.connectSocket({\n\t\t\t\turl: `${this.config.url}?identify=${this.config.identify}&token=${this.config.token}&session_id=${this.config.session_id}`\n\t\t\t});\n\t\t\tif (res.errMsg === 'connectSocket:ok') {\n\t\t\t\tthis.initEventHandle();\n\t\t\t}\n\t\t}\n\t}\n\n\t// 发送消息\n\tasync send(msg = \"\") {\n\t\tif (uni.getStorageSync('isSocketOpen')) {\n\t\t\tlet [error, res] = await uni.sendSocketMessage({\n\t\t\t\tdata: msg\n\t\t\t});\n\t\t\treturn Promise.resolve(res);\n\t\t}\n\t}\n\n\t// 监听消息\n\tonMsg() {\n\t\tuni.onSocketMessage(res => {\n\t\t\tif (res.code === 1 && res.type === 'init') {\n\t\t\t\tthis.config.session_id = res.data.session_id;\n\t\t\t}\n\t\t\tthis.callback(res)\n\t\t});\n\t}\n\n\t// 关闭连接\n\tclose() {\n\t\tuni.closeSocket();\n\t\tuni.removeStorage({\n\t\t\tkey: 'isSocketOpen',\n\t\t\tsuccess: (res) => {\n\t\t\t\tconsole.log('移除isSocketOpensuccess');\n\t\t\t}\n\t\t});\n\t\tclearTimeout(this.timer);\n\t\tclearTimeout(this.timeoutObj);\n\t}\n\n\t//心跳检测\n\tstart() {\n\t\tclearTimeout(this.timeoutObj);\n\t\tthis.timeoutObj = setTimeout(() => {\n\t\t\tlet obj = {\n\t\t\t\ttype: 'ping'\n\t\t\t};\n\t\t\tlet objStr = JSON.stringify(obj)\n\t\t\tuni.sendSocketMessage({\n\t\t\t\tdata: objStr,\n\t\t\t});\n\t\t\tthis.start()\n\t\t}, this.timout)\n\t}\n\n\t// 监听事件集\n\tinitEventHandle() {\n\t\t// 监听打开\n\t\tuni.onSocketOpen(res => {\n\t\t\tuni.setStorageSync('isSocketOpen', true)\n\t\t\tconsole.log('连接成功！');\n\t\t\tthis.lockReconnect = true;\n\t\t\tthis.isClose = false;\n\t\t\tthis.start()\n\t\t});\n\n\t\t// 监听消息\n\t\tthis.onMsg()\n\n\t\t// 监听错误\n\t\tuni.onSocketError(err => {\n\t\t\tconsole.log('连接错误', err);\n\t\t\tuni.closeSocket();\n\t\t});\n\n\t\t// 监听关闭\n\t\tuni.onSocketClose(res => {\n\t\t\tconsole.log('关闭链接');\n\t\t\tthis.isClose = true;\n\t\t\tif (uni.getStorageSync('isSocketOpen')) {\n\t\t\t\tthis.lockReconnect = false\n\t\t\t\tthis.reconnect()\n\t\t\t}\n\n\n\t\t});\n\t}\n\n\t// 重连\n\treconnect() {\n\t\tif (this.lockReconnect) return;\n\t\tclearTimeout(this.timer)\n\t\tif (this.limit < 12) {\n\t\t\tthis.timer = setTimeout(() => {\n\t\t\t\tconsole.log('重连中', this.limit);\n\t\t\t\tthis.init();\n\t\t\t\tthis.reconnect()\n\t\t\t}, 5000);\n\t\t\tthis.limit += 1\n\t\t}\n\t}\n\n\n}\n","import {\n\tBASE_URL\n} from '@/env.js'\nconst expression = [{\n\t\t'title': '[zy]',\n\t\t'src': '/emoji/1.png'\n\t}, {\n\t\t'title': '[zm]',\n\t\t'src': '/emoji/2.png'\n\t}, {\n\t\t'title': '[jy]',\n\t\t'src': '/emoji/3.png'\n\t},\n\t{\n\t\t'title': '[jyb]',\n\t\t'src': '/emoji/4.png'\n\t}, {\n\t\t'title': '[bx]',\n\t\t'src': '/emoji/5.png'\n\t}, {\n\t\t'title': '[kzn]',\n\t\t'src': '/emoji/6.png'\n\t},\n\t{\n\t\t'title': '[gg]',\n\t\t'src': '/emoji/7.png'\n\t}, {\n\t\t'title': '[ll]',\n\t\t'src': '/emoji/8.png'\n\t}, {\n\t\t'title': '[jyll]',\n\t\t'src': '/emoji/9.png'\n\t},\n\t{\n\t\t'title': '[o]',\n\t\t'src': '/emoji/10.png'\n\t}, {\n\t\t'title': '[yz]',\n\t\t'src': '/emoji/11.png'\n\t}, {\n\t\t'title': '[wx]',\n\t\t'src': '/emoji/12.png'\n\t},\n\t{\n\t\t'title': '[zyb]',\n\t\t'src': '/emoji/13.png'\n\t}, {\n\t\t'title': '[tp]',\n\t\t'src': '/emoji/14.png'\n\t}, {\n\t\t'title': '[wxb]',\n\t\t'src': '/emoji/15.png'\n\t},\n\t{\n\t\t'title': '[zyc]',\n\t\t'src': '/emoji/16.png'\n\t}, {\n\t\t'title': '[llb]',\n\t\t'src': '/emoji/17.png'\n\t}, {\n\t\t'title': '[xm]',\n\t\t'src': '/emoji/18.png'\n\t},\n\t{\n\t\t'title': '[qz]',\n\t\t'src': '/emoji/19.png'\n\t}, {\n\t\t'title': '[zmb]',\n\t\t'src': '/emoji/20.png'\n\t}, {\n\t\t'title': '[kx]',\n\t\t'src': '/emoji/21.png'\n\t},\n\t{\n\t\t'title': '[mm]',\n\t\t'src': '/emoji/22.png'\n\t}, {\n\t\t'title': '[bz]',\n\t\t'src': '/emoji/23.png'\n\t}, {\n\t\t'title': '[bkx]',\n\t\t'src': '/emoji/24.png'\n\t},\n\t{\n\t\t'title': '[mg]',\n\t\t'src': '/emoji/25.png'\n\t}, {\n\t\t'title': '[pz]',\n\t\t'src': '/emoji/26.png'\n\t}, {\n\t\t'title': '[pzb]',\n\t\t'src': '/emoji/27.png'\n\t},\n\t{\n\t\t'title': '[wxc]',\n\t\t'src': '/emoji/28.png'\n\t}, {\n\t\t'title': '[jyc]',\n\t\t'src': '/emoji/29.png'\n\t}, {\n\t\t'title': '[jyd]',\n\t\t'src': '/emoji/30.png'\n\t},\n\t{\n\t\t'title': '[dm]',\n\t\t'src': '/emoji/31.png'\n\t}, {\n\t\t'title': '[tpb]',\n\t\t'src': '/emoji/32.png'\n\t}, {\n\t\t'title': '[tpc]',\n\t\t'src': '/emoji/33.png'\n\t},\n\t{\n\t\t'title': '[tpd]',\n\t\t'src': '/emoji/34.png'\n\t}, {\n\t\t'title': '[ly]',\n\t\t'src': '/emoji/35.png'\n\t}, {\n\t\t'title': '[zyd]',\n\t\t'src': '/emoji/36.png'\n\t},\n];\n\nlet service = BASE_URL.split('://')[1].split(':')[0];\nexport default {\n\tbaseURL: service, // dev.7wpp.com 启动workerman服务的域名，无需填写协议和端口\n\thttps_switch: false, // 是否启用https协议(默认关，正式版必开，且需要参考文档创建wss服务)\n\texpression\n}\n"],"sourceRoot":""}